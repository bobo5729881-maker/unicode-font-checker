<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>Unicode å­—å…ƒè¾¨è­˜èˆ‡é¡¯ç¤ºå·¥å…·</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- LINE é¢¨æ ¼ -->
<style>
:root {
  --line-green: #06c755;
  --bg: #f5f6f7;
  --card: #ffffff;
  --text: #222;
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "PingFang TC",
               "Noto Sans CJK TC", "Microsoft JhengHei", sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  background: var(--line-green);
  color: white;
  padding: 18px;
  font-size: 20px;
  text-align: center;
  font-weight: bold;
}

main {
  max-width: 720px;
  margin: auto;
  padding: 16px;
}

.card {
  background: var(--card);
  border-radius: 18px;
  padding: 16px;
  margin-bottom: 16px;
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.card h2 {
  margin-top: 0;
  font-size: 18px;
}

input[type="file"], textarea, button {
  width: 100%;
  margin-top: 10px;
  padding: 10px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-size: 16px;
}

button {
  background: var(--line-green);
  color: white;
  border: none;
  cursor: pointer;
}

button.secondary {
  background: #ddd;
  color: #333;
}

.candidates {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
  gap: 12px;
  margin-top: 12px;
}

.char-box {
  background: #fafafa;
  border-radius: 12px;
  padding: 10px;
  text-align: center;
  cursor: pointer;
  border: 2px solid transparent;
}

.char-box:hover {
  border-color: var(--line-green);
}

.char {
  font-size: 32px;
}

.code {
  font-size: 12px;
  color: #666;
  margin-top: 4px;
}

.fonts {
  font-family:
    "PingFang TC",
    "Noto Sans CJK TC",
    "HanaMinA",
    "BabelStone Han",
    serif;
}
</style>

<!-- OCR -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, addDoc, collection } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ğŸ”´ æ›æˆä½ è‡ªå·±çš„ Firebase è¨­å®š */
const firebaseConfig = {
  apiKey: "AIzaSyBorZUX_fx-v4wtXHF29W_Lp828MlyjUbM",
  authDomain: "strangewd-2f657.firebaseapp.com",
  projectId: "strangewd-2f657",
  storageBucket: "strangewd-2f657.firebasestorage.app",
  messagingSenderId: "367763384160",
  appId: "1:367763384160:web:d45aee261360203c086005",
  measurementId: "G-3ZMPQYGFTQ"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.saveResult = async function(imageText, candidates) {
  await addDoc(collection(db, "ocrResults"), {
    input: imageText,
    candidates,
    time: Date.now()
  });
};
</script>
</head>

<body>

<header>Unicode å­—å…ƒè¾¨è­˜å·¥å…·</header>

<main>

<!-- Aï¼šè²¼å­— -->
<div class="card">
<h2>ğŸ…°ï¸ è²¼ä¸Šä½ çœ‹åˆ°çš„å­—ï¼ˆå³ä½¿ç³»çµ±é¡¯ç¤ºä¸å‡ºä¾†ï¼‰</h2>
<textarea id="textInput" placeholder="è²¼ä¸Šä¸€å€‹å­—"></textarea>
<button onclick="fromText()">æœå°‹ Unicode</button>
</div>

<!-- Bï¼šåœ–ç‰‡ -->
<div class="card">
<h2>ğŸ…±ï¸ ä¸Šå‚³å­—çš„æˆªåœ–ï¼ˆOCRï¼‰</h2>
<input type="file" id="imageInput" accept="image/*" />
<button onclick="runOCR()">é–‹å§‹è¾¨è­˜</button>
<button class="secondary" onclick="runOCR()">é‡æ–°è¾¨è­˜</button>
<div id="ocrStatus"></div>
</div>

<!-- çµæœ -->
<div class="card">
<h2>ğŸ” å¯èƒ½çš„ Unicode å­—ï¼ˆé»æ“Šå¯è¤‡è£½ï¼‰</h2>
<div id="results" class="candidates"></div>
</div>

</main>

<script>
const resultsDiv = document.getElementById("results");

function showCandidates(chars) {
  resultsDiv.innerHTML = "";
  chars.slice(0,10).forEach(ch => {
    const box = document.createElement("div");
    box.className = "char-box fonts";
    box.innerHTML = `
      <div class="char">${ch}</div>
      <div class="code">U+${ch.codePointAt(0).toString(16).toUpperCase()}</div>
    `;
    box.onclick = () => {
      navigator.clipboard.writeText(ch);
      alert("å·²è¤‡è£½ï¼š" + ch);
    };
    resultsDiv.appendChild(box);
  });
}

function fromText() {
  const ch = document.getElementById("textInput").value.trim();
  if (!ch) return;
  showCandidates([ch]);
}

async function runOCR() {
  const file = document.getElementById("imageInput").files[0];
  if (!file) return;

  document.getElementById("ocrStatus").innerText = "OCR è¾¨è­˜ä¸­â€¦";

  const { data } = await Tesseract.recognize(file, "chi_tra+chi_sim+jpn");
  const text = data.text.replace(/\s/g, "");

  // âš ï¸ é€™è£¡å…ˆç”¨ OCR å­—ä¸²æ‹†è§£æˆå€™é¸å­—ï¼ˆå¾ŒçºŒå¯æ¥ç­†ç•«æ¯”å°ï¼‰
  const chars = Array.from(new Set(text)).filter(c => c.length === 1);

  showCandidates(chars);

  if (window.saveResult) {
    saveResult(text, chars);
  }

  document.getElementById("ocrStatus").innerText = "å®Œæˆï¼ˆå¯é‡æ–°è¾¨è­˜ï¼‰";
}
</script>

</body>
</html>
